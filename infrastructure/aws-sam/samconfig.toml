# SAM Configuration for Full-Stack Blog Application
# 
# SECURITY NOTE: This file uses placeholder values for production.
# Copy to samconfig.development.toml and replace placeholders for actual deployment.
#
version = 0.1

[default.global.parameters]
stack_name = "blogapp"

[default.build.parameters]
cached = true
parallel = true
use_container = false

[default.deploy.parameters]
capabilities = "CAPABILITY_IAM"
confirm_changeset = false
resolve_s3 = true
region = "ap-northeast-1"
disable_rollback = false
fail_on_empty_changeset = false

[default.local_start_api.parameters]
warm_containers = "EAGER"

[default.local_start_lambda.parameters]
warm_containers = "EAGER"

# =============================================================================
# ECR SETUP (Run first to create ECR repositories)
# =============================================================================
[ecr-development.global.parameters]
stack_name = "blogapp-development-ecr"

[ecr-development.deploy.parameters]
template_file = "template-ecr.yml"
capabilities = "CAPABILITY_IAM"
confirm_changeset = false
resolve_s3 = true
region = "ap-northeast-1"
parameter_overrides = ["Environment=development"]
tags = ["Environment=development", "Project=blogapp", "Component=ECR"]

[ecr-staging.global.parameters]
stack_name = "blogapp-staging-ecr"

[ecr-staging.deploy.parameters]
template_file = "template-ecr.yml"
capabilities = "CAPABILITY_IAM"
confirm_changeset = false
resolve_s3 = true
region = "ap-northeast-1"
parameter_overrides = ["Environment=staging"]
tags = ["Environment=staging", "Project=blogapp", "Component=ECR"]

[ecr-production.global.parameters]
stack_name = "blogapp-production-ecr"

[ecr-production.deploy.parameters]
template_file = "template-ecr.yml"
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
resolve_s3 = true
region = "ap-northeast-1"
parameter_overrides = ["Environment=production"]
tags = ["Environment=production", "Project=blogapp", "Component=ECR"]

# =============================================================================
# DEVELOPMENT ENVIRONMENT (Safe to commit) (Local Only)
# =============================================================================
[development.global.parameters]
stack_name = "blogapp-development"

[development.deploy.parameters]
capabilities = "CAPABILITY_IAM"
confirm_changeset = false
resolve_s3 = true
resolve_image_repos = true
region = "ap-northeast-1"
parameter_overrides = [
    "Environment=development",
    # https://<branch名>--<プロジェクト名>.vercel.app / https://<デプロイ固有のID>-<プロジェクト名>.vercel.app
    # e.g. https://feature-login--myapp.vercel.app / https://abc12345-myapp.vercel.app
    "AllowedOrigins=http://localhost:3000",
    "FirebaseProjectId=demo-project"
]
tags = [
    "Environment=development",
    "Project=blogapp"
]

# =============================================================================
# STAGING ENVIRONMENT (Update FirebaseProjectId before deployment)
# =============================================================================
[staging.global.parameters]
stack_name = "blogapp-staging"

[staging.deploy.parameters]
capabilities = "CAPABILITY_IAM"
confirm_changeset = false
resolve_s3 = true
resolve_image_repos = true
region = "ap-northeast-1"
parameter_overrides = [
    "Environment=staging",
    "AllowedOrigins=*",
    "FirebaseProjectId=next-firebase-auth-5dc5a"
]
tags = [
    "Environment=staging",
    "Project=blogapp"
]

# =============================================================================
# PRODUCTION ENVIRONMENT (SECURITY: Update all placeholders before deployment)
# =============================================================================
[production.global.parameters] 
stack_name = "blogapp-production"

[production.deploy.parameters]
capabilities = "CAPABILITY_IAM"
confirm_changeset = true  # Always confirm production changes
resolve_s3 = true
resolve_image_repos = true
region = "ap-northeast-1"
parameter_overrides = [
    "Environment=production",
    "AllowedOrigins=REPLACE_WITH_PRODUCTION_DOMAIN",  # e.g., https://yourdomain.com
    "FirebaseProjectId=REPLACE_WITH_PRODUCTION_PROJECT_ID"
]
tags = [
    "Environment=production",
    "Project=blogapp",
    "CostCenter=Production"
]
